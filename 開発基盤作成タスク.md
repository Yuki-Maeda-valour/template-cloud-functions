# TypeScript Cloud Functions 開発基盤作成タスク

## プロジェクト概要
- TypeScript での Google Cloud Functions 開発環境
- Gmail、Google Drive、Google Sheets API 連携
- OAuth2 認証システム
- Git によるバージョン管理

## 1. プロジェクト初期化

### 1.1 Git リポジトリの初期化
- [ ] `git init` でリポジトリを初期化
- [ ] `.gitignore` ファイルを作成（Node.js/TypeScript 用）
- [ ] 初回コミットを作成

### 1.2 Node.js プロジェクトの初期化
- [ ] `npm init -y` でpackage.jsonを作成
- [ ] プロジェクト情報を適切に設定

## 2. TypeScript 環境のセットアップ

### 2.1 TypeScript 関連パッケージのインストール
- [ ] TypeScript をインストール (`typescript`, `@types/node`)
- [ ] esbuild をインストール（高速ビルド用）
- [ ] TypeScript 設定ファイル `tsconfig.json` を作成
- [ ] esbuild 用ビルドスクリプトを package.json に追加

### 2.2 開発ツールのセットアップ
- [ ] Biome のインストールと設定（リンター + フォーマッター統合）
- [ ] Biome 設定ファイル `biome.json` の作成
- [ ] dotenv のインストール（環境変数管理）
- [ ] nodemon のインストール（開発時の自動リロード）
- [ ] esbuild watch モードの設定

## 3. Google Cloud Functions のセットアップ

### 3.1 Functions Framework のインストール
- [ ] `@google-cloud/functions-framework` をインストール
- [ ] Functions Framework 用の設定ファイル作成
- [ ] esbuild + Functions Framework 連携設定
- [ ] ローカル開発用のスクリプトを package.json に追加
- [ ] ホットリロード対応の開発環境構築

### 3.2 Google Cloud SDK の設定
- [ ] Google Cloud CLI のインストール確認
- [ ] プロジェクトの認証設定
- [ ] デプロイ用スクリプトの作成

## 4. Google APIs クライアントライブラリのセットアップ

### 4.1 googleapis パッケージのインストール
- [ ] `googleapis` パッケージをインストール
- [ ] 各 API 用の型定義を確認

### 4.2 API 有効化
- [ ] Gmail API の有効化
- [ ] Google Drive API の有効化
- [ ] Google Sheets API の有効化

## 5. OAuth2 認証システムの実装

### 5.1 認証設定ファイルの準備
- [ ] Google Cloud Console でOAuth2クライアントを作成
- [ ] 認証情報ファイル（credentials.json）の設置
- [ ] `.env` ファイルの作成と環境変数設定
- [ ] `.env.example` テンプレートファイルの作成
- [ ] dotenv を使った環境変数の読み込み設定

### 5.2 OAuth2 フローの実装
- [ ] 認証用のヘルパー関数を作成
- [ ] トークン管理システムの実装
- [ ] リフレッシュトークンの処理

## 6. プロジェクト構造の作成

### 6.1 ディレクトリ構造
```
src/
├── functions/          # Cloud Functions のエントリーポイント
├── services/          # Google APIs サービス層
│   ├── gmail.ts
│   ├── drive.ts
│   └── sheets.ts
├── auth/              # 認証関連
├── utils/             # ユーティリティ関数
└── types/             # TypeScript 型定義
```

### 6.2 基本ファイルの作成
- [ ] 各ディレクトリとファイルの作成
- [ ] 基本的な型定義ファイルの作成
- [ ] サンプル関数の実装

## 7. テスト環境のセットアップ

### 7.1 テストフレームワークの導入
- [ ] Vitest のインストールと設定
- [ ] Vitest 設定ファイル `vitest.config.ts` の作成
- [ ] esbuild との連携設定
- [ ] テスト用スクリプトを package.json に追加

### 7.2 モック設定
- [ ] Google APIs のモック設定
- [ ] 認証フローのモック設定

## 8. CI/CD パイプラインの基礎

### 8.1 GitHub Actions の設定（オプション）
- [ ] `.github/workflows` ディレクトリの作成
- [ ] テスト自動実行の設定
- [ ] デプロイ自動化の基礎設定

## 9. ドキュメントの作成

### 9.1 プロジェクトドキュメント
- [ ] 詳細な README.md の作成（以下の内容を含む）
  - [ ] プロジェクト概要と機能説明
  - [ ] 環境構築手順（Node.js、Google Cloud CLI）
  - [ ] 依存関係のインストール手順
  - [ ] 環境変数設定（.env ファイルの設定例）
  - [ ] Google Cloud Console での OAuth2 設定手順
  - [ ] 各種 API の有効化手順
  - [ ] ローカル開発サーバーの起動方法
  - [ ] ビルド・テスト・リント実行方法
  - [ ] デプロイ手順（Cloud Functions）
  - [ ] 利用可能なスクリプト一覧
  - [ ] トラブルシューティング
  - [ ] コード構成とアーキテクチャ説明
- [ ] API 仕様書の基礎
- [ ] 開発ガイドラインの作成

### 9.2 セットアップガイド
- [ ] 環境構築手順
- [ ] 認証設定手順
- [ ] デプロイ手順

## 10. セキュリティ設定

### 10.1 環境変数とシークレット管理
- [ ] `.env` ファイルを `.gitignore` に追加
- [ ] 環境変数の型定義ファイル作成
- [ ] 開発・本番環境での環境変数分離
- [ ] Google Cloud Secret Manager の活用検討
- [ ] 認証情報の安全な管理方法の確立

### 10.2 セキュリティベストプラクティス
- [ ] CORS 設定
- [ ] レート制限の実装検討
- [ ] ログ記録システムの設計

## 完了チェックリスト

- [ ] プロジェクトがローカルで正常に動作する
- [ ] esbuild による TypeScript ビルドが成功する
- [ ] Functions Framework でローカル開発サーバーが起動する
- [ ] ファイル変更時の自動リロードが動作する
- [ ] Biome によるリントとフォーマットが正常に動作する
- [ ] `.env` ファイルから環境変数が正常に読み込まれる
- [ ] Vitest でテストが実行できる
- [ ] 基本的な Cloud Function をデプロイできる
- [ ] Google APIs への認証が成功する
- [ ] Git でプロジェクトが管理されている
- [ ] 詳細な README.md が作成されている
- [ ] 新しい開発者が README だけで環境構築できる

## 次のステップ

基盤が完成した後：
1. 各 Google API の具体的な機能実装
2. エラーハンドリングの強化
3. ログ・モニタリングシステムの導入
4. パフォーマンス最適化
5. 本番環境へのデプロイ設定